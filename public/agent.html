<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AJ STUDIOZ - AI Assistant</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&family=Poppins:wght@300;400;600&family=Play:wght@400;700&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
    
    <style>
        :root {
            --primary-bg: #ffffff;
            --secondary-bg: #f8f9fa;
            --sidebar-bg: #f3f4f6;
            --input-bg: #ffffff;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --text-tertiary: #9ca3af;
            --accent-color: #0078d4;
            --border-color: #e5e7eb;
            --hover-bg: #f9fafb;
            --message-user-bg: #e3f2fd;
            --message-ai-bg: #ffffff;
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.1);
            --border-radius: 6px;
            --border-radius-lg: 12px;
            --logo-gradient: linear-gradient(135deg, #0078d4, #106ebe);
            --aj-gold: #FBBF24;
            --aj-gold-glow: rgba(251, 191, 36, 0.6);
            --aj-green: #10b981;
            --aj-green-glow: rgba(16, 185, 129, 0.7);
            --code-bg: #0d1117;
            --code-text: #f0f6fc;
            --code-header-bg: #161b22;
            --copilot-blue: #0078d4;
            --copilot-blue-light: #e3f2fd;
        }

        [data-theme="dark"] {
            --primary-bg: #1e1e1e;
            --secondary-bg: #2d2d30;
            --sidebar-bg: #252526;
            --input-bg: #3c3c3c;
            --text-primary: #cccccc;
            --text-secondary: #9d9d9d;
            --text-tertiary: #707070;
            --hover-bg: #2a2d2e;
            --message-user-bg: #0e4775;
            --message-ai-bg: #2d2d30;
            --border-color: #3e3e42;
            --code-bg: #0d1117;
            --code-text: #f0f6fc;
            --code-header-bg: #161b22;
        }

        /* Login Page Styles - Enhanced for Mobile */
        .login-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #020202;
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Poppins', sans-serif;
            overflow: hidden;
        }

        .spotlight {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0) 40%);
            pointer-events: none;
            transition: transform 0.1s ease-out;
        }

        .vault-container {
            position: relative;
            width: 90%;
            max-width: 450px;
            height: 450px;
            perspective: 1500px;
        }

        #vault-toggle {
            display: none;
        }

        .vault-door {
            position: absolute;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transform-origin: left center;
            transition: transform 1.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            transition-delay: 1.2s; 
            cursor: pointer;
            z-index: 20;
            animation: door-intro 1s ease-out forwards;
            opacity: 0;
        }
        
        #vault-toggle:checked ~ .vault-door {
            transform: rotateY(-130deg) translateX(-20px);
        }

        .door-face {
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, #444444, #2a2a2a);
            border-radius: 20px;
            box-shadow: inset 0 0 30px rgba(0,0,0,0.7), 5px 5px 30px rgba(0,0,0,0.8);
            backface-visibility: hidden;
            overflow: hidden;
        }
        
        .door-face::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 200%;
            background: linear-gradient(0deg, transparent 50%, rgba(0, 255, 140, 0.05) 50%);
            background-size: 100% 6px;
            animation: scanlines 10s linear infinite;
        }

        .door-face.front {
            transform: translateZ(40px);
            border: 5px solid #1a1a1a;
        }
        
        .door-face.back {
            background: #2a2a2a;
            transform: rotateY(180deg) translateZ(40px);
        }
        
        .locking-bar {
            position: absolute;
            background: linear-gradient(to right, #2c2c2c, #4a4a4a, #2c2c2c);
            box-shadow: 0 5px 15px rgba(0,0,0,0.6);
            transition: transform 0.5s cubic-bezier(0.65, 0, 0.35, 1);
            z-index: -1;
        }
        .locking-bar.horizontal { left: -15%; width: 130%; height: 30px; }
        .locking-bar.vertical { top: -15%; width: 30px; height: 130%; background: linear-gradient(to bottom, #2c2c2c, #4a4a4a, #2c2c2c); }
        
        .locking-bar:nth-of-type(1) { top: 30%; animation: slide-in-right 1s 0.2s forwards; transform: translateX(150%); } 
        .locking-bar:nth-of-type(2) { bottom: 30%; animation: slide-in-left 1s 0.2s forwards; transform: translateX(-150%); } 
        .locking-bar:nth-of-type(3) { left: 30%; animation: slide-in-down 1s 0.4s forwards; transform: translateY(150%); } 
        .locking-bar:nth-of-type(4) { right: 30%; animation: slide-in-up 1s 0.4s forwards; transform: translateY(-150%); } 

        .vault-handle {
            position: absolute;
            top: 50%; left: 50%;
            width: 220px;
            height: 220px;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 5;
            transition: transform 0.8s ease-in-out;
            transform: translate(-50%, -50%) scale(0);
            animation: handle-intro 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) 0.8s forwards;
        }
        
        .handle-ring {
            position: absolute;
            width: 100%; height: 100%;
            background: linear-gradient(45deg, #2c2c2c, #4a4a4a);
            border-radius: 50%;
            border: 8px solid #222;
            box-shadow: 0 0 35px rgba(0,0,0,0.9), inset 0 0 15px #000;
        }
        
        .handle-center {
            width: 90px;
            height: 90px;
            background: linear-gradient(145deg, #FBBF24, #b48b1e);
            border-radius: 50%;
            border: 3px solid #f0e68c;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
            color: #fff;
            text-align: center;
            line-height: 90px;
            font-size: 2.5rem;
            font-family: 'Play', sans-serif;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            transition: all 0.5s ease;
            animation: pulse-gold 2.5s infinite;
            z-index: 10;
        }

        #vault-toggle:checked ~ .vault-door .handle-ring {
            animation: turn-handle 1s cubic-bezier(0.6, -0.28, 0.74, 0.05) forwards;
        }
        #vault-toggle:checked ~ .vault-door .handle-center {
            background: linear-gradient(145deg, #34D399, #16a34a);
            border-color: #a7f3d0;
            box-shadow: 0 0 35px rgba(52, 211, 153, 0.7), inset 0 0 10px rgba(0,0,0,0.5);
            text-shadow: 0 0 10px #fff;
            animation: none;
        }
        #vault-toggle:checked ~ .vault-door .locking-bar:nth-of-type(1) { animation: retract-right 0.5s 0.7s forwards; }
        #vault-toggle:checked ~ .vault-door .locking-bar:nth-of-type(2) { animation: retract-left 0.5s 0.7s forwards; }
        #vault-toggle:checked ~ .vault-door .locking-bar:nth-of-type(3) { animation: retract-down 0.5s 0.7s forwards; }
        #vault-toggle:checked ~ .vault-door .locking-bar:nth-of-type(4) { animation: retract-up 0.5s 0.7s forwards; }

        .login-form-container {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(10, 10, 10, 0.5);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: inset 0 0 50px #000;
            padding: 40px;
            box-sizing: border-box;
            z-index: 10;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .login-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5rem;
            text-align: center;
            font-weight: 700;
            text-transform: uppercase;
            margin: 0 0 10px;
            color: #E5E7EB;
            letter-spacing: 0.1em;
            text-shadow: 0 0 5px rgba(255,255,255,0.2), 0 0 15px rgba(52, 211, 153, 0.7);
            animation: glitch 5s infinite;
        }

        .login-form-container h2 { margin: 0 0 10px; color: #FBBF24; font-family: 'Play', sans-serif; font-size: 1.8rem; text-align: center; text-shadow: 0 0 10px rgba(251, 191, 36, 0.6); }
        .login-form-container p { margin: 0 0 30px; color: #E5E7EB; font-size: 0.9rem; text-align: center; opacity: 0.8; }
        .input-group { position: relative; width: 100%; margin-bottom: 20px; }
        .input-group input { width: 100%; padding: 12px; background: rgba(0,0,0,0.3); border: 2px solid #2a2a2a; border-radius: 5px; color: #E5E7EB; font-size: 1rem; box-sizing: border-box; outline: none; transition: border-color 0.3s, box-shadow 0.3s; }
        .input-group input:focus { border-color: #FBBF24; box-shadow: 0 0 15px rgba(251, 191, 36, 0.6); }
        .login-button { width: 100%; padding: 12px; border: none; border-radius: 5px; background: #FBBF24; color: #111; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.3s; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 15px; }
        .login-button:hover { background-color: #ffdf85; box-shadow: 0 0 20px rgba(251, 191, 36, 0.6); transform: translateY(-3px); }
        .login-button:active { transform: translateY(-1px); }
        
        .google-login-button {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 5px;
            background: #4285F4;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .google-login-button:hover {
            background-color: #357ae8;
            box-shadow: 0 0 20px rgba(66, 133, 244, 0.6);
            transform: translateY(-3px);
        }
        
        .google-login-button:active {
            transform: translateY(-1px);
        }
        
        .signup-link {
            text-align: center;
            margin-top: 20px;
            color: #E5E7EB;
            font-size: 0.9rem;
        }
        
        .signup-link a {
            color: #FBBF24;
            text-decoration: none;
            font-weight: 600;
        }
        
        .signup-link a:hover {
            text-decoration: underline;
        }

        @keyframes door-intro { to { opacity: 1; } }
        @keyframes handle-intro { to { transform: translate(-50%, -50%) scale(1); } }
        @keyframes slide-in-left { to { transform: translateX(0); } }
        @keyframes slide-in-right { to { transform: translateX(0); } }
        @keyframes slide-in-up { to { transform: translateY(0); } }
        @keyframes slide-in-down { to { transform: translateY(0); } }
        
        @keyframes pulse-gold {
            0%, 100% { box-shadow: inset 0 0 10px rgba(0,0,0,0.5), 0 0 15px rgba(251, 191, 36, 0.6); }
            50% { box-shadow: inset 0 0 10px rgba(0,0,0,0.5), 0 0 25px rgba(251, 191, 36, 0.6); }
        }
        @keyframes turn-handle {
            0% { transform: rotate(0deg); }
            20% { transform: rotate(-15deg); }
            80% { transform: rotate(200deg); }
            100% { transform: rotate(180deg); }
        }
        @keyframes retract-up { to { transform: translateY(-150%); } }
        @keyframes retract-down { to { transform: translateY(150%); } }
        @keyframes retract-left { to { transform: translateX(-150%); } }
        @keyframes retract-right { to { transform: translateX(150%); } }
        
        @keyframes scanlines {
            0% { transform: translateY(0); }
            100% { transform: translateY(-100%); }
        }
        
        @keyframes glitch { 
            0%, 100% { text-shadow: 0 0 5px rgba(255,255,255,0.2), 0 0 15px rgba(52, 211, 153, 0.7); } 
            49% { text-shadow: 0 0 5px rgba(255,255,255,0.2), 0 0 15px rgba(52, 211, 153, 0.7); } 
            50% { text-shadow: 2px 2px 5px rgba(52, 211, 153, 0.7), -2px -2px 5px rgba(251, 191, 36, 0.6); } 
            51% { text-shadow: 0 0 5px rgba(255,255,255,0.2), 0 0 15px rgba(52, 211, 153, 0.7); } 
        }

        /* Main App Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: var(--primary-bg);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .app-container {
            display: flex;
            height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background-color: var(--sidebar-bg);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            position: relative;
            transition: transform 0.3s ease;
        }

        .sidebar-header {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: var(--logo-gradient);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 16px;
            box-shadow: 0 2px 8px rgba(0, 120, 212, 0.3);
        }

        .logo-text {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 1px;
        }

        .new-chat-btn {
            width: 100%;
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: var(--border-radius);
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s ease;
            font-size: 14px;
        }

        .new-chat-btn:hover {
            background-color: #106ebe;
            transform: translateY(-1px);
        }

        .search-bar {
            margin: 16px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 8px 12px 8px 36px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: var(--input-bg);
            color: var(--text-primary);
            font-size: 13px;
            outline: none;
            transition: all 0.2s ease;
        }

        .search-input:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px rgba(0, 120, 212, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-tertiary);
            font-size: 14px;
        }

        .chat-history {
            flex: 1;
            overflow-y: auto;
            padding: 0 8px 8px;
        }

        .chat-history-item {
            padding: 10px 12px;
            margin-bottom: 2px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--text-secondary);
            font-size: 13px;
            line-height: 1.4;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chat-history-item:hover {
            background-color: var(--hover-bg);
            color: var(--text-primary);
        }

        .chat-history-item.active {
            background-color: var(--secondary-bg);
            color: var(--text-primary);
        }

        .chat-history-item i {
            font-size: 12px;
            opacity: 0.6;
        }

        .project-section {
            margin-top: 16px;
            padding: 0 8px;
        }

        .project-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            color: var(--text-tertiary);
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .project-item {
            padding: 8px 12px;
            margin-bottom: 2px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--text-secondary);
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .project-item:hover {
            background-color: var(--hover-bg);
            color: var(--text-primary);
        }

        .sidebar-footer {
            padding: 16px;
            border-top: 1px solid var(--border-color);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .user-profile:hover {
            background-color: var(--hover-bg);
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #0078d4, #106ebe);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .user-status {
            font-size: 11px;
            color: var(--text-tertiary);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: var(--primary-bg);
            position: relative;
        }

        .main-header {
            height: 60px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            background-color: var(--secondary-bg);
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .ai-avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--logo-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: 600;
        }

        .header-title h1 {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .header-subtitle {
            font-size: 12px;
            color: var(--text-tertiary);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .model-selector {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            outline: none;
            transition: all 0.2s ease;
        }

        .model-selector:hover {
            background-color: var(--hover-bg);
        }

        .tone-selector {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            outline: none;
            transition: all 0.2s ease;
        }

        .tone-selector:hover {
            background-color: var(--hover-bg);
        }

        .header-btn {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
        }

        .header-btn:hover {
            background-color: var(--hover-bg);
            color: var(--text-primary);
        }

        /* Quota Usage Bar */
        .quota-usage {
            position: absolute;
            top: 60px;
            left: 0;
            right: 0;
            height: 4px;
            background-color: var(--border-color);
            z-index: 10;
        }

        .quota-usage-bar {
            height: 100%;
            background: var(--logo-gradient);
            transition: width 0.3s ease;
        }

        /* Plan Upgrade Banner */
        .upgrade-banner {
            background: var(--logo-gradient);
            color: white;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 13px;
        }

        .upgrade-banner button {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .upgrade-banner button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Chat Layout */
        .chat-layout {
            flex: 1;
            display: flex;
            overflow: hidden;
            position: relative;
        }

        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 24px;
            max-height: calc(100vh - 200px);
        }

        .chat-container::-webkit-scrollbar {
            width: 6px;
        }

        .chat-container::-webkit-scrollbar-track {
            background: transparent;
        }

        .chat-container::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }

        .chat-container::-webkit-scrollbar-thumb:hover {
            background: var(--text-tertiary);
        }

        .sidebar-right {
            width: 300px;
            background-color: var(--sidebar-bg);
            border-left: 1px solid var(--border-color);
            overflow-y: auto;
            display: none;
            flex-direction: column;
        }

        .sidebar-right.active {
            display: flex;
        }

        .preview-container {
            flex: 1;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            overflow: hidden;
            margin: 16px;
            display: flex;
            flex-direction: column;
        }

        .preview-header {
            background-color: var(--hover-bg);
            padding: 8px 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
        }

        .preview-actions {
            display: flex;
            gap: 6px;
        }

        .preview-content {
            width: 100%;
            height: 100%;
            border: none;
            background-color: white;
        }

        /* Microsoft Copilot Style Messages */
        .message {
            display: flex;
            gap: 16px;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
            opacity: 0;
            animation: messageSlideIn 0.4s ease-out forwards;
            position: relative;
        }

        @keyframes messageSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            flex-direction: row-reverse;
            align-self: flex-end;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-weight: 600;
            font-size: 14px;
            position: relative;
        }

        .message.user .message-avatar {
            background: linear-gradient(135deg, #0078d4, #106ebe);
            color: white;
        }

        .message.ai .message-avatar {
            background: linear-gradient(135deg, var(--aj-gold), #ff8c61);
            color: white;
            position: relative;
        }

        .message.ai .message-avatar::after {
            content: '';
            position: absolute;
            bottom: -2px;
            right: -2px;
            width: 12px;
            height: 12px;
            background: var(--aj-green);
            border-radius: 50%;
            border: 2px solid var(--primary-bg);
        }

        .message-content {
            flex: 1;
            max-width: calc(100% - 48px);
        }

        .message-bubble {
            background-color: var(--message-ai-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            padding: 20px;
            position: relative;
            word-wrap: break-word;
            line-height: 1.7;
            font-size: 15px;
            box-shadow: var(--shadow);
        }

        .message.user .message-bubble {
            background: var(--copilot-blue-light);
            border-color: rgba(0, 120, 212, 0.3);
            color: var(--text-primary);
        }

        .message-timestamp {
            font-size: 12px;
            color: var(--text-tertiary);
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Message Actions */
        .message-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            opacity: 0;
            transition: opacity 0.3s ease;
            flex-wrap: wrap;
        }

        .message:hover .message-actions {
            opacity: 1;
        }

        .message-action {
            background: var(--secondary-bg);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 6px 12px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .message-action:hover {
            background-color: var(--hover-bg);
            color: var(--text-primary);
            border-color: var(--accent-color);
            transform: translateY(-1px);
        }

        /* Copilot Style Formatted Content */
        .copilot-response {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            font-size: 15px;
            line-height: 1.7;
            color: var(--text-primary);
        }

        .copilot-response p {
            margin: 0 0 16px 0;
        }

        .copilot-response p:last-child {
            margin-bottom: 0;
        }

        .copilot-response h1, .copilot-response h2, .copilot-response h3, 
        .copilot-response h4, .copilot-response h5, .copilot-response h6 {
            margin: 24px 0 16px 0;
            font-weight: 600;
            color: var(--text-primary);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        .copilot-response h1 { 
            font-size: 24px; 
            border-bottom: 2px solid var(--border-color); 
            padding-bottom: 8px; 
        }
        .copilot-response h2 { 
            font-size: 20px; 
            border-bottom: 1px solid var(--border-color); 
            padding-bottom: 6px; 
        }
        .copilot-response h3 { font-size: 18px; }
        .copilot-response h4 { font-size: 16px; }

        .copilot-response ul, .copilot-response ol {
            margin: 16px 0;
            padding-left: 24px;
        }

        .copilot-response li {
            margin-bottom: 8px;
            line-height: 1.6;
        }

        .copilot-response blockquote {
            border-left: 4px solid var(--accent-color);
            padding: 16px 20px;
            margin: 20px 0;
            background: var(--secondary-bg);
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
            color: var(--text-secondary);
            font-style: italic;
        }

        .copilot-response strong {
            font-weight: 600;
            color: var(--text-primary);
        }

        .copilot-response em {
            font-style: italic;
            color: var(--text-secondary);
        }

        .copilot-response code {
            background: var(--secondary-bg);
            padding: 3px 6px;
            border-radius: 4px;
            font-family: 'JetBrains Mono', 'Fira Code', monospace;
            font-size: 13px;
            color: var(--accent-color);
            border: 1px solid var(--border-color);
        }

        /* Enhanced Code Blocks - Copilot Style */
        .copilot-code-block {
            margin: 24px 0;
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            background: var(--code-bg);
            border: 1px solid var(--code-header-bg);
            box-shadow: var(--shadow-lg);
            transition: all 0.3s ease;
            position: relative;
        }

        .copilot-code-block:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .copilot-code-header {
            background: var(--code-header-bg);
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }

        .copilot-code-header::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--aj-gold), transparent);
        }

        .code-language-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: var(--aj-gold);
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.5px;
            background: rgba(251, 191, 36, 0.1);
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid rgba(251, 191, 36, 0.2);
        }

        .code-language-badge i {
            font-size: 10px;
        }

        .copilot-code-actions {
            display: flex;
            gap: 8px;
        }

        .copilot-code-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--code-text);
            padding: 6px 12px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 11px;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .copilot-code-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: var(--aj-gold);
            transform: translateY(-1px);
        }

        .copilot-code-btn.success {
            background: rgba(16, 185, 129, 0.2);
            border-color: var(--aj-green);
            color: var(--aj-green);
        }

        .copilot-code-content {
            padding: 20px;
            overflow-x: auto;
            font-family: 'JetBrains Mono', 'Fira Code', 'Monaco', monospace;
            font-size: 14px;
            line-height: 1.6;
            color: var(--code-text);
            background: var(--code-bg);
            position: relative;
        }

        .copilot-code-content::-webkit-scrollbar {
            height: 8px;
        }

        .copilot-code-content::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }

        .copilot-code-content::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }

        .copilot-code-content::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .copilot-code-content pre {
            margin: 0;
            padding: 0;
            background: none;
            border: none;
            font-family: inherit;
            font-size: inherit;
            line-height: inherit;
            color: inherit;
        }

        .copilot-code-content code {
            background: none;
            padding: 0;
            border: none;
            font-family: inherit;
            font-size: inherit;
            color: inherit;
        }

        /* Tables - Copilot Style */
        .copilot-table-container {
            margin: 20px 0;
            overflow-x: auto;
            border-radius: var(--border-radius-lg);
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow);
        }

        .copilot-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--primary-bg);
            font-size: 14px;
        }

        .copilot-table th {
            background: var(--secondary-bg);
            padding: 16px;
            text-align: left;
            font-weight: 600;
            color: var(--text-primary);
            border-bottom: 2px solid var(--border-color);
            position: relative;
        }

        .copilot-table th:first-child {
            border-top-left-radius: var(--border-radius-lg);
        }

        .copilot-table th:last-child {
            border-top-right-radius: var(--border-radius-lg);
        }

        .copilot-table td {
            padding: 16px;
            color: var(--text-secondary);
            border-bottom: 1px solid var(--border-color);
        }

        .copilot-table tr:hover {
            background: var(--hover-bg);
        }

        .copilot-table tr:last-child td:first-child {
            border-bottom-left-radius: var(--border-radius-lg);
        }

        .copilot-table tr:last-child td:last-child {
            border-bottom-right-radius: var(--border-radius-lg);
        }

        /* Microsoft Copilot Typing Indicator */
        .copilot-typing {
            display: flex;
            align-items: center;
            gap: 16px;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
            animation: messageSlideIn 0.4s ease-out forwards;
        }

        .copilot-typing .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--aj-gold), #ff8c61);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            font-weight: 600;
            position: relative;
        }

        .copilot-typing .message-avatar::after {
            content: '';
            position: absolute;
            bottom: -2px;
            right: -2px;
            width: 12px;
            height: 12px;
            background: var(--aj-green);
            border-radius: 50%;
            border: 2px solid var(--primary-bg);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.8; }
        }

        .copilot-typing-bubble {
            background: var(--message-ai-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            padding: 20px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 120px;
        }

        .copilot-typing-text {
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
        }

        .copilot-typing-dots {
            display: flex;
            gap: 4px;
        }

        .copilot-typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent-color);
            animation: typingDots 1.5s infinite ease-in-out;
        }

        .copilot-typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .copilot-typing-dot:nth-child(2) { animation-delay: -0.16s; }
        .copilot-typing-dot:nth-child(3) { animation-delay: 0s; }

        @keyframes typingDots {
            0%, 80%, 100% {
                transform: scale(0.8);
                opacity: 0.5;
            }
            40% {
                transform: scale(1.2);
                opacity: 1;
            }
        }

        /* Enhanced Settings Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            animation: modalFadeIn 0.3s ease-out;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--primary-bg);
            border-radius: var(--border-radius-lg);
            width: 90%;
            max-width: 600px;
            max-height: 85vh;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            border: 1px solid var(--border-color);
            animation: modalSlideIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
        }

        @keyframes modalSlideIn {
            from { 
                opacity: 0;
                transform: scale(0.9) translateY(-20px);
            }
            to { 
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .modal-header {
            background: linear-gradient(135deg, var(--accent-color), #106ebe);
            color: white;
            padding: 24px 32px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            overflow: hidden;
        }

        .modal-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
            z-index: 1;
        }

        .modal-title i {
            font-size: 24px;
        }

        .modal-close {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            position: relative;
            z-index: 1;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .modal-body {
            padding: 32px;
            overflow-y: auto;
            max-height: calc(85vh - 120px);
        }

        .modal-body::-webkit-scrollbar {
            width: 6px;
        }

        .modal-body::-webkit-scrollbar-track {
            background: var(--secondary-bg);
            border-radius: 3px;
        }

        .modal-body::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }

        .modal-body::-webkit-scrollbar-thumb:hover {
            background: var(--text-tertiary);
        }

        .settings-section {
            margin-bottom: 32px;
            background: var(--secondary-bg);
            border-radius: var(--border-radius-lg);
            padding: 24px;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .settings-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, var(--accent-color), var(--aj-gold));
        }

        .settings-section h3 {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .settings-section h3 i {
            color: var(--accent-color);
        }

        .setting-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 0;
            border-bottom: 1px solid var(--border-color);
            transition: all 0.2s ease;
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-item:hover {
            padding-left: 8px;
            background: rgba(0, 120, 212, 0.02);
            border-radius: var(--border-radius);
            margin: 0 -8px;
            padding-right: 8px;
        }

        .setting-label {
            font-size: 15px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .setting-description {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .enhanced-toggle {
            position: relative;
            width: 52px;
            height: 28px;
            background: var(--border-color);
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
        }

        .enhanced-toggle.active {
            background: var(--accent-color);
            box-shadow: 0 0 20px rgba(0, 120, 212, 0.3);
        }

        .enhanced-toggle::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .enhanced-toggle.active::after {
            transform: translateX(24px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .enhanced-select {
            width: 140px;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background: var(--input-bg);
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 500;
            outline: none;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .enhanced-select:focus, .enhanced-select:hover {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(0, 120, 212, 0.1);
        }

        /* Input Area */
        .input-area {
            padding: 20px;
            border-top: 1px solid var(--border-color);
            background: var(--secondary-bg);
        }

        .input-container {
            max-width: 800px;
            margin: 0 auto;
            position: relative;
        }

        .input-wrapper {
            display: flex;
            align-items: flex-end;
            gap: 12px;
            background: var(--input-bg);
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            padding: 12px 16px;
            transition: all 0.3s ease;
            box-shadow: var(--shadow);
        }

        .input-wrapper:focus-within {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(0, 120, 212, 0.1), var(--shadow);
        }

        .message-input {
            flex: 1;
            background: transparent;
            border: none;
            outline: none;
            color: var(--text-primary);
            font-size: 15px;
            line-height: 1.5;
            resize: none;
            min-height: 24px;
            max-height: 150px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        .message-input::placeholder {
            color: var(--text-tertiary);
        }

        .input-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .input-btn {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 8px;
            border-radius: var(--border-radius);
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .input-btn:hover {
            background: var(--hover-bg);
            color: var(--text-primary);
            transform: scale(1.1);
        }

        .send-btn {
            background: var(--accent-color);
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .send-btn:hover {
            background: #106ebe;
            transform: scale(1.1);
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .send-btn.loading {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Empty State */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            max-width: 600px;
            margin: 0 auto;
            text-align: center;
            padding: 60px 20px;
        }

        .empty-state-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--aj-gold), #ff8c61);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 24px;
            font-size: 32px;
            color: white;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .empty-state h2 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-primary);
        }

        .empty-state p {
            font-size: 16px;
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 32px;
        }

        .suggestion-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            width: 100%;
        }

        .suggestion-card {
            background: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .suggestion-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, var(--accent-color), var(--aj-gold));
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .suggestion-card:hover {
            background: var(--hover-bg);
            border-color: var(--accent-color);
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .suggestion-card:hover::before {
            transform: scaleX(1);
        }

        .suggestion-card h3 {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .suggestion-card p {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.5;
            margin: 0;
        }

        /* Toast notifications */
        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: var(--primary-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: var(--shadow-lg);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 1000;
            max-width: 400px;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.success {
            border-color: var(--aj-green);
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), var(--primary-bg));
        }

        .toast.success i {
            color: var(--aj-green);
        }

        .toast.error {
            border-color: #ef4444;
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), var(--primary-bg));
        }

        .toast.error i {
            color: #ef4444;
        }

        /* Status Indicator */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: var(--text-tertiary);
            margin-left: 12px;
            padding: 4px 8px;
            border-radius: 12px;
            background: var(--secondary-bg);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #6b7280;
        }

        .status-dot.online {
            background: var(--aj-green);
            animation: pulse 2s infinite;
        }

        .status-dot.offline {
            background: #ef4444;
        }

        /* Mobile Responsive - ENHANCED STABILITY */
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
                height: 100vh;
                overflow: hidden;
            }

            .sidebar {
                width: 100%;
                height: auto;
                position: fixed;
                top: 0;
                left: -100%;
                z-index: 1000;
                transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                box-shadow: var(--shadow-lg);
            }

            .sidebar.open {
                left: 0;
            }

            .main-content {
                width: 100%;
                height: 100vh;
                display: flex;
                flex-direction: column;
            }

            .main-header {
                height: 56px;
                padding: 0 16px;
                flex-shrink: 0;
            }

            .header-title h1 {
                font-size: 14px;
            }

            .header-subtitle {
                font-size: 10px;
            }

            .header-actions {
                gap: 4px;
            }

            .header-btn, .model-selector, .tone-selector {
                padding: 4px 8px;
                font-size: 11px;
            }

            .chat-layout {
                flex: 1;
                overflow: hidden;
            }

            .chat-container {
                flex: 1;
                padding: 16px;
                gap: 20px;
                max-height: none;
                height: calc(100vh - 200px);
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }

            .message {
                max-width: 100%;
                gap: 12px;
            }

            .message-content {
                max-width: calc(100% - 44px);
            }

            .message-bubble {
                padding: 16px;
                font-size: 14px;
                line-height: 1.6;
            }

            .copilot-code-block {
                margin: 16px 0;
                border-radius: var(--border-radius);
            }

            .copilot-code-header {
                padding: 10px 12px;
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .copilot-code-actions {
                width: 100%;
                justify-content: flex-end;
            }

            .copilot-code-content {
                padding: 16px 12px;
                font-size: 13px;
                line-height: 1.5;
            }

            .copilot-code-btn {
                padding: 4px 8px;
                font-size: 10px;
            }

            .input-area {
                padding: 16px;
                background: var(--primary-bg);
                border-top: 1px solid var(--border-color);
                flex-shrink: 0;
            }

            .input-wrapper {
                padding: 12px;
                gap: 8px;
            }

            .message-input {
                font-size: 14px;
                max-height: 120px;
            }

            .input-btn {
                padding: 6px;
                font-size: 14px;
            }

            .send-btn {
                width: 32px;
                height: 32px;
            }

            .sidebar-right {
                display: none !important;
            }

            .empty-state {
                padding: 40px 16px;
                height: calc(100vh - 200px);
                justify-content: flex-start;
                padding-top: 80px;
            }

            .empty-state-icon {
                width: 64px;
                height: 64px;
                font-size: 24px;
            }

            .empty-state h2 {
                font-size: 20px;
            }

            .empty-state p {
                font-size: 14px;
            }

            .suggestion-cards {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .suggestion-card {
                padding: 16px;
            }

            .suggestion-card h3 {
                font-size: 14px;
            }

            .suggestion-card p {
                font-size: 13px;
            }

            .modal-content {
                width: 95%;
                max-height: 90vh;
                margin: 20px;
            }

            .modal-header {
                padding: 20px;
            }

            .modal-title {
                font-size: 18px;
            }

            .modal-body {
                padding: 20px;
                max-height: calc(90vh - 140px);
            }

            .settings-section {
                padding: 16px;
                margin-bottom: 16px;
            }

            .settings-section h3 {
                font-size: 16px;
            }

            .setting-item {
                padding: 12px 0;
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .enhanced-select {
                width: 100%;
                margin-top: 8px;
            }

            .enhanced-toggle {
                margin-top: 8px;
            }

            .toast {
                left: 16px;
                right: 16px;
                bottom: 16px;
                max-width: none;
            }

            .status-indicator {
                display: none;
            }

            /* Prevent zoom on input focus */
            .message-input {
                font-size: 16px;
            }

            /* Improve touch targets */
            .input-btn, .message-action, .copilot-code-btn {
                min-width: 44px;
                min-height: 44px;
            }

            /* Better scroll performance */
            .chat-container {
                will-change: scroll-position;
                transform: translateZ(0);
            }
            
            /* Login Page Mobile Optimizations */
            .vault-container {
                width: 90%;
                max-width: 350px;
                height: 350px;
            }
            
            .login-title {
                font-size: 2rem;
            }
            
            .login-form-container h2 {
                font-size: 1.5rem;
            }
            
            .vault-handle {
                width: 180px;
                height: 180px;
            }
            
            .handle-center {
                width: 70px;
                height: 70px;
                line-height: 70px;
                font-size: 2rem;
            }
            
            .login-form-container {
                padding: 30px;
            }
        }

        /* Tablet Responsive */
        @media (min-width: 769px) and (max-width: 1024px) {
            .sidebar {
                width: 240px;
            }

            .sidebar-right {
                width: 280px;
            }

            .chat-container {
                padding: 18px;
            }

            .message {
                max-width: 90%;
            }

            .copilot-code-content {
                font-size: 13px;
            }
        }

        /* Large Desktop */
        @media (min-width: 1440px) {
            .sidebar {
                width: 280px;
            }

            .sidebar-right {
                width: 320px;
            }

            .message {
                max-width: 900px;
            }

            .chat-container {
                max-width: 1200px;
                margin: 0 auto;
            }

            .copilot-code-content {
                font-size: 15px;
            }
        }

        /* Ultra-wide */
        @media (min-width: 1920px) {
            .sidebar {
                width: 320px;
            }

            .sidebar-right {
                width: 400px;
            }

            .message {
                max-width: 1000px;
            }

            .chat-container {
                max-width: 1400px;
                margin: 0 auto;
            }
        }

        /* Dark theme improvements */
        [data-theme="dark"] .copilot-code-block {
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        [data-theme="dark"] .modal-content {
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        }

        [data-theme="dark"] .suggestion-card:hover {
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        /* High contrast mode support */
        @media (prefers-contrast: high) {
            :root {
                --border-color: #000000;
                --text-secondary: #333333;
            }

            [data-theme="dark"] {
                --border-color: #ffffff;
                --text-secondary: #cccccc;
            }
        }

        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="login-page">
        <div class="spotlight"></div>

        <div class="vault-container">
            <input type="checkbox" id="vault-toggle">
            
            <label for="vault-toggle" class="vault-door">
                <div class="door-face front">
                    <div class="locking-bar horizontal"></div>
                    <div class="locking-bar horizontal"></div>
                    <div class="locking-bar vertical"></div>
                    <div class="locking-bar vertical"></div>

                    <div class="vault-handle">
                        <div class="handle-ring"></div>
                        <div class="handle-center">AJ</div>
                    </div>
                </div>
                <div class="door-face back"></div>
            </label>
            
            <div class="login-form-container">
                <h1 class="login-title">AJ STUDIOZ</h1>
                <h2>SECURE ACCESS</h2>
                <p>Enter credentials to proceed.</p>
                <form id="loginForm">
                    <div class="input-group">
                        <input type="email" id="emailInput" placeholder="Email Address" required>
                    </div>
                    <div class="input-group">
                        <input type="password" id="passwordInput" placeholder="Password" required>
                    </div>
                    <button type="submit" class="login-button">Authenticate</button>
                </form>
                
                <button id="googleLoginBtn" class="google-login-button">
                    <i class="fab fa-google"></i>
                    Sign in with Google
                </button>
                
                <div class="signup-link">
                    Don't have an account? <a href="#" id="signupLink">Sign up</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="app-container" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">AJ</div>
                    <div class="logo-text">STUDIOZ</div>
                </div>
                <button class="new-chat-btn" onclick="startNewChat()">
                    <i class="fas fa-plus"></i>
                    New Chat
                </button>
            </div>
            
            <div class="search-bar">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="search-input" placeholder="Search conversations..." onkeyup="searchConversations(this.value)">
            </div>
            
            <div class="chat-history" id="chatHistory">
                <!-- Chat history items will be added dynamically -->
            </div>
            
            <div class="project-section">
                <div class="project-header">
                    <span>Projects</span>
                    <i class="fas fa-plus" style="cursor: pointer; font-size: 12px;" onclick="createNewProject()"></i>
                </div>
                <div id="projectList">
                    <!-- Project items will be added dynamically -->
                </div>
            </div>
            
            <div class="sidebar-footer">
                <div class="user-profile" onclick="openSettings()">
                    <div class="user-avatar" id="userAvatar">K</div>
                    <div class="user-info">
                        <div class="user-name" id="userName">Karthik</div>
                        <div class="user-status" id="userStatus">Free Plan</div>
                    </div>
                    <i class="fas fa-cog" style="color: var(--text-tertiary);"></i>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="main-header">
                <div class="header-title">
                    <div class="ai-avatar">AJ</div>
                    <div>
                        <h1>AJ STUDIOZ AI Assistant</h1>
                        <div class="header-subtitle">Powered by Claude Sonnet-4</div>
                    </div>
                    <div class="status-indicator">
                        <span class="status-dot online" id="statusDot"></span>
                        <span id="statusText">Online</span>
                    </div>
                </div>
                
                <div class="header-actions">
                    <select class="model-selector" onchange="changeModel(this.value)">
                        <option value="claude-3-sonnet">Claude 3 Sonnet</option>
                        <option value="claude-3-opus">Claude 3 Opus</option>
                        <option value="claude-3-haiku">Claude 3 Haiku</option>
                    </select>
                    
                    <select class="tone-selector" onchange="changeTone(this.value)">
                        <option value="professional">Professional</option>
                        <option value="casual">Casual</option>
                        <option value="friendly">Friendly</option>
                        <option value="analytical">Analytical</option>
                    </select>
                    
                    <button class="header-btn" onclick="toggleTheme()">
                        <i class="fas fa-moon"></i>
                    </button>
                    
                    <button class="header-btn" onclick="clearChat()">
                        <i class="fas fa-trash"></i>
                        Clear
                    </button>
                    
                    <button class="header-btn" onclick="toggleSidebar()">
                        <i class="fas fa-bars"></i>
                    </button>
                    
                    <button class="header-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>

            <div class="quota-usage">
                <div class="quota-usage-bar" id="quotaBar" style="width: 65%;"></div>
            </div>

            <div class="upgrade-banner" id="upgradeBanner">
                <span>Upgrade to Pro for unlimited messages and advanced features</span>
                <button onclick="upgradePlan()">Upgrade Now</button>
            </div>

            <div class="chat-layout">
                <div class="chat-container" id="chatContainer">
                    <!-- Empty state -->
                    <div class="empty-state" id="emptyState">
                        <div class="empty-state-icon">
                            <i class="fas fa-robot"></i>
                        </div>
                        <h2>Hello! I'm your AJ STUDIOZ AI Assistant</h2>
                        <p>I can help you with coding, creative writing, analysis, and answering questions. How can I assist you today?</p>
                        
                        <div class="suggestion-cards">
                            <div class="suggestion-card" onclick="sendSuggestion('Create a modern landing page with HTML, CSS, and JavaScript')">
                                <h3> Web Development</h3>
                                <p>Create a modern landing page with animations</p>
                            </div>
                            <div class="suggestion-card" onclick="sendSuggestion('Help me debug this Python code that is not working correctly')">
                                <h3> Code Debugging</h3>
                                <p>Debug and fix code issues</p>
                            </div>
                            <div class="suggestion-card" onclick="sendSuggestion('Write a creative story about AI and humans working together')">
                                <h3> Creative Writing</h3>
                                <p>Generate stories and creative content</p>
                            </div>
                            <div class="suggestion-card" onclick="sendSuggestion('Explain quantum computing in simple terms with examples')">
                                <h3> Explanations</h3>
                                <p>Explain complex topics simply</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Sidebar - Preview Only -->
                <div class="sidebar-right" id="sidebarRight">
                    <div class="preview-container">
                        <div class="preview-header">
                            <span>Preview</span>
                            <div class="preview-actions">
                                <button class="copilot-code-btn" onclick="refreshPreview()">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                                <button class="copilot-code-btn" onclick="openInNewTab()">
                                    <i class="fas fa-external-link-alt"></i> Open
                                </button>
                            </div>
                        </div>
                        <iframe id="previewFrame" class="preview-content" sandbox="allow-scripts"></iframe>
                    </div>
                </div>
            </div>

            <div class="input-area">
                <div class="input-container">
                    <div class="input-wrapper" id="inputWrapper">
                        <textarea 
                            class="message-input" 
                            id="messageInput" 
                            placeholder="Message AJ STUDIOZ AI..."
                            rows="1"
                            onkeydown="handleKeyDown(event)"
                            oninput="autoResize(this)"
                        ></textarea>
                        <div class="input-actions">
                            <button class="input-btn" onclick="attachFile()" title="Attach file">
                                <i class="fas fa-paperclip"></i>
                            </button>
                            <button class="input-btn" onclick="startVoiceInput()" title="Voice input">
                                <i class="fas fa-microphone"></i>
                            </button>
                            <button class="send-btn" id="sendBtn" onclick="sendMessage()" disabled title="Send message">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-cogs"></i>
                    Settings
                </h2>
                <button class="modal-close" onclick="closeSettings()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h3><i class="fas fa-user"></i>Account</h3>
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">Email Address</div>
                            <div class="setting-description" id="userEmail">karthik@example.com</div>
                        </div>
                    </div>
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">Subscription Plan</div>
                            <div class="setting-description" id="userPlan">Free Plan - 35 messages remaining</div>
                        </div>
                        <button class="header-btn" onclick="upgradePlan()">
                            <i class="fas fa-crown"></i> Upgrade
                        </button>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3><i class="fas fa-palette"></i>Appearance</h3>
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">Dark Mode</div>
                            <div class="setting-description">Toggle between light and dark themes</div>
                        </div>
                        <div class="enhanced-toggle" id="themeToggle" onclick="toggleTheme()"></div>
                    </div>
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">Default Response Tone</div>
                            <div class="setting-description">Set the default tone for AI responses</div>
                        </div>
                        <select class="enhanced-select" onchange="changeDefaultTone(this.value)">
                            <option value="professional">Professional</option>
                            <option value="casual">Casual</option>
                            <option value="friendly">Friendly</option>
                            <option value="analytical">Analytical</option>
                        </select>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3><i class="fas fa-brain"></i>AI Behavior</h3>
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">Context Memory</div>
                            <div class="setting-description">Remember conversation context across sessions</div>
                        </div>
                        <div class="enhanced-toggle active" id="memoryToggle" onclick="toggleMemory()"></div>
                    </div>
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">Code Suggestions</div>
                            <div class="setting-description">Show code completion and suggestions</div>
                        </div>
                        <div class="enhanced-toggle active" id="codeToggle" onclick="toggleCodeSuggestions()"></div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3><i class="fas fa-shield-alt"></i>Privacy & Data</h3>
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">Save Chat History</div>
                            <div class="setting-description">Store conversations for future reference</div>
                        </div>
                        <div class="enhanced-toggle active" id="historyToggle" onclick="toggleHistory()"></div>
                    </div>
                    <div class="setting-item">
                        <div>
                            <div class="setting-label">Analytics & Improvement</div>
                            <div class="setting-description">Help improve AI performance with usage data</div>
                        </div>
                        <div class="enhanced-toggle" id="dataToggle" onclick="toggleDataUsage()"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast notification -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toastMessage">Message sent successfully!</span>
    </div>

    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyC_i3zb-WpmYOz1oJuwYaKvYAFivaNTXQQ",
            authDomain: "aj-06-318af.firebaseapp.com",
            projectId: "aj-06-318af",
            storageBucket: "aj-06-318af.firebasestorage.app",
            messagingSenderId: "888538013305",
            appId: "1:888538013305:web:40f028b0b93018e24d7ea8",
            measurementId: "G-WFYVZNBYSV"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();

        // Initialize highlight.js
        hljs.highlightAll();
        
        // Global State Management
        const state = {
            auth: {
                user: null,
                session: 'active',
                role: 'user'
            },
            chat: {
                activeSession: null,
                messages: [],
                contextWindow: [],
                pendingMessages: [],
                hasMessages: false,
                typingMessage: null
            },
            ui: {
                modals: { settings: false },
                theme: 'light',
                sidebarOpen: false,
                rightSidebarOpen: false
            },
            preferences: {
                tone: 'professional',
                memoryEnabled: true,
                historyEnabled: true,
                dataUsageEnabled: false,
                codeSuggestionsEnabled: true
            },
            quota: {
                used: 65,
                total: 100,
                messagesLeft: 35
            },
            api: {
                status: 'online',
                lastCheck: null
            },
            code: {
                current: '',
                language: 'html',
                preview: ''
            }
        };
        
        // DOM elements
        const loginPage = document.getElementById('loginPage');
        const mainApp = document.getElementById('mainApp');
        const chatContainer = document.getElementById('chatContainer');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        const emptyState = document.getElementById('emptyState');
        const sidebar = document.getElementById('sidebar');
        const sidebarRight = document.getElementById('sidebarRight');
        const toast = document.getElementById('toast');
        const inputWrapper = document.getElementById('inputWrapper');
        const settingsModal = document.getElementById('settingsModal');
        const upgradeBanner = document.getElementById('upgradeBanner');
        const statusDot = document.getElementById('statusDot');
        const statusText = document.getElementById('statusText');
        const previewFrame = document.getElementById('previewFrame');
        
        // Login form elements
        const loginForm = document.getElementById('loginForm');
        const emailInput = document.getElementById('emailInput');
        const passwordInput = document.getElementById('passwordInput');
        const googleLoginBtn = document.getElementById('googleLoginBtn');
        const signupLink = document.getElementById('signupLink');
        
        // User profile elements
        const userAvatar = document.getElementById('userAvatar');
        const userName = document.getElementById('userName');
        const userStatus = document.getElementById('userStatus');
        const userEmail = document.getElementById('userEmail');
        const userPlan = document.getElementById('userPlan');
        
        // Spotlight effect for login page
        const spotlight = document.querySelector('.spotlight');
        document.addEventListener('mousemove', (e) => {
            if (loginPage.style.display !== 'none') {
                const { clientX, clientY } = e;
                const x = (clientX / window.innerWidth) * 100;
                const y = (clientY / window.innerHeight) * 100;
                spotlight.style.background = `radial-gradient(circle at ${x}% ${y}%, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0) 40%)`;
            }
        });
        
        // Authentication state observer
        auth.onAuthStateChanged(user => {
            if (user) {
                state.auth.user = user;
                showMainApp();
                updateUserProfile(user);
            } else {
                state.auth.user = null;
                showLoginPage();
            }
        });
        
        function showLoginPage() {
            loginPage.style.display = 'flex';
            mainApp.style.display = 'none';
        }
        
        function showMainApp() {
            loginPage.style.display = 'none';
            mainApp.style.display = 'flex';
            initializeApp();
        }
        
        function updateUserProfile(user) {
            if (user.displayName) {
                userName.textContent = user.displayName;
                userAvatar.textContent = user.displayName.charAt(0).toUpperCase();
            } else {
                userName.textContent = 'User';
                userAvatar.textContent = 'U';
            }
            
            userEmail.textContent = user.email;
            
            if (state.auth.user.plan === 'pro') {
                userStatus.textContent = 'Pro Plan';
                userPlan.textContent = 'Pro Plan - Unlimited messages';
                upgradeBanner.style.display = 'none';
            } else {
                userStatus.textContent = 'Free Plan';
                userPlan.textContent = 'Free Plan - 35 messages remaining';
                upgradeBanner.style.display = 'flex';
            }
        }
        
        // Login form submission
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = emailInput.value;
            const password = passwordInput.value;
            
            auth.signInWithEmailAndPassword(email, password)
                .then(userCredential => {
                    showToast('Login successful!', 'success');
                })
                .catch(error => {
                    showToast(`Login failed: ${error.message}`, 'error');
                });
        });
        
        // Google sign-in
        googleLoginBtn.addEventListener('click', () => {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider)
                .then(result => {
                    showToast('Google sign-in successful!', 'success');
                })
                .catch(error => {
                    showToast(`Google sign-in failed: ${error.message}`, 'error');
                });
        });
        
        // Sign up link
        signupLink.addEventListener('click', (e) => {
            e.preventDefault();
            const email = prompt('Enter your email address:');
            if (email) {
                const password = prompt('Create a password:');
                if (password) {
                    auth.createUserWithEmailAndPassword(email, password)
                        .then(userCredential => {
                            showToast('Account created successfully!', 'success');
                        })
                        .catch(error => {
                            showToast(`Sign up failed: ${error.message}`, 'error');
                        });
                }
            }
        });
        
        function logout() {
            auth.signOut()
                .then(() => {
                    showToast('Logged out successfully!', 'success');
                })
                .catch(error => {
                    showToast('Logout failed: ' + error.message, 'error');
                });
        }
        
        function initializeApp() {
            messageInput.focus();
            updateQuotaBar();
            setupEventListeners();
            loadSampleData();
            
            if (state.auth.user && state.auth.user.plan !== 'pro') {
                upgradeBanner.style.display = 'flex';
            } else {
                upgradeBanner.style.display = 'none';
            }
        }
        
        function setupEventListeners() {
            document.addEventListener('keydown', function(e) {
                if (e.key === '/' && document.activeElement !== messageInput) {
                    e.preventDefault();
                    messageInput.focus();
                }
                if (e.key === 'Escape') {
                    closeSettings();
                    if (state.ui.sidebarOpen) toggleSidebar();
                }
            });
            
            window.addEventListener('resize', function() {
                if (window.innerWidth > 768) {
                    sidebar.classList.remove('open');
                }
            });
            
            document.addEventListener('click', function(event) {
                if (window.innerWidth <= 768 && 
                    sidebar.classList.contains('open') && 
                    !sidebar.contains(event.target) && 
                    !event.target.closest('.header-btn')) {
                    sidebar.classList.remove('open');
                }
            });
        }
        
        function loadSampleData() {
            const sampleChats = [
                { id: 1, title: "Create a React dashboard", type: 'chat' },
                { id: 2, title: "Explain machine learning", type: 'chat' },
                { id: 3, title: "Debug JavaScript error", type: 'chat' },
                { id: 4, title: "Write a product description", type: 'chat' }
            ];
            
            const chatHistory = document.getElementById('chatHistory');
            chatHistory.innerHTML = '';
            sampleChats.forEach(chat => {
                const historyItem = document.createElement('div');
                historyItem.className = 'chat-history-item';
                historyItem.innerHTML = `
                    <i class="fas fa-message"></i>
                    <span>${chat.title}</span>
                `;
                historyItem.onclick = () => loadChat(chat.id);
                chatHistory.appendChild(historyItem);
            });
            
            const sampleProjects = [
                { id: 1, title: "Web Development", icon: 'fas fa-code' },
                { id: 2, title: "Content Creation", icon: 'fas fa-pen' },
                { id: 3, title: "Research", icon: 'fas fa-search' }
            ];
            
            const projectList = document.getElementById('projectList');
            projectList.innerHTML = '';
            sampleProjects.forEach(project => {
                const projectItem = document.createElement('div');
                projectItem.className = 'project-item';
                projectItem.innerHTML = `
                    <i class="${project.icon}"></i>
                    <span>${project.title}</span>
                `;
                projectItem.onclick = () => loadProject(project.id);
                projectList.appendChild(projectItem);
            });
        }
        
        // Auto-resize textarea
        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 150) + 'px';
            sendBtn.disabled = !textarea.value.trim();
        }
        
        function handleKeyDown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                if (!sendBtn.disabled) {
                    sendMessage();
                }
            }
        }
        
        // Microsoft Copilot Style Message Sending with Typing Effect
        async function sendMessage() {
            const message = messageInput.value.trim();
            if (!message || state.chat.pendingMessages.length > 0) return;
            
            if (state.quota.messagesLeft <= 0) {
                showToast('Message quota exceeded. Please upgrade your plan.', 'error');
                return;
            }
            
            if (state.api.status !== 'online') {
                showToast('AI is currently offline. Please try again later.', 'error');
                return;
            }
            
            // Clear input
            messageInput.value = '';
            messageInput.style.height = 'auto';
            sendBtn.disabled = true;
            
            // Hide empty state
            if (emptyState) {
                emptyState.style.display = 'none';
            }
            
            // Add user message with Copilot styling
            addCopilotMessage('user', message);
            
            // Show Copilot typing indicator
            showCopilotTypingIndicator();
            
            // Enable preview sidebar after first message
            if (!state.chat.hasMessages) {
                state.chat.hasMessages = true;
                if (window.innerWidth > 768) {
                    sidebarRight.classList.add('active');
                }
            }
            
            state.chat.pendingMessages.push(message);
            
            try {
                // Simulate API call with realistic delay
                await new Promise(resolve => setTimeout(resolve, 1500 + Math.random() * 2000));
                
                // Remove typing indicator
                removeCopilotTypingIndicator();
                
                // Generate mock AI response with limited length
                const aiResponse = generateMockResponse(message);
                
                // Add AI response with typing effect
                await addCopilotMessageWithTypingEffect('ai', aiResponse);
                
                // Extract and handle code
                extractCodeFromResponse(aiResponse);
                
                // Update quota
                state.quota.used += 1;
                state.quota.messagesLeft -= 1;
                updateQuotaBar();
                
                state.chat.pendingMessages = state.chat.pendingMessages.filter(msg => msg !== message);
                addToChatHistory(message);
                
                showToast('Response generated successfully!', 'success');
                
            } catch (error) {
                console.error('Error sending message:', error);
                removeCopilotTypingIndicator();
                addCopilotMessage('ai', 'I apologize, but I encountered an error while processing your request. Please try again.');
                showToast('Failed to generate response: ' + error.message, 'error');
                state.chat.pendingMessages = state.chat.pendingMessages.filter(msg => msg !== message);
            }
        }
        
        // Generate mock responses with limited length (1000 tokens)
        function generateMockResponse(userMessage) {
            const lowerMessage = userMessage.toLowerCase();
            
            if (lowerMessage.includes('code') || lowerMessage.includes('html') || lowerMessage.includes('css') || lowerMessage.includes('javascript')) {
                return `I'll help you create a modern web component. Here's a complete example:

## Modern Card Component

This component features a clean design with hover effects and responsive behavior.

\`\`\`html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Card Component</title>
    <style>
        .card {
            background: linear-gradient(145deg, #ffffff, #f0f0f0);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }
        
        .card-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 12px;
        }
        
        .card-content {
            color: #6b7280;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="card">
        <h3 class="card-title">Modern Design</h3>
        <p class="card-content">This card component uses modern CSS techniques including gradients, smooth transitions, and subtle shadows for a professional appearance.</p>
    </div>
</body>
</html>
\`\`\`

The code above creates a beautiful, interactive card component with:

- **Gradient background** for visual depth
- **Smooth hover animations** using CSS transforms
- **Modern spacing** and typography
- **Responsive design** principles

You can customize the colors, spacing, and effects to match your project's design system.`;
            }
            
            if (lowerMessage.includes('explain') || lowerMessage.includes('what is')) {
                return `Let me provide a comprehensive explanation:

## Key Concepts

Understanding this topic requires breaking it down into several important components:

### 1. **Fundamental Principles**
The core concepts that form the foundation of this subject are essential for building a solid understanding.

### 2. **Practical Applications**
These principles can be applied in various real-world scenarios:

- **Business applications** - How this applies in professional settings
- **Technical implementation** - The technical aspects and considerations
- **Best practices** - Industry-standard approaches and methodologies

### 3. **Advanced Considerations**

For more complex scenarios, you'll want to consider:

> "The key to mastering any concept is understanding not just the 'what' but also the 'why' and 'when' to apply it."

This approach ensures you can adapt the knowledge to different situations and contexts.

Would you like me to dive deeper into any specific aspect of this topic?`;
            }
            
            return `Thank you for your question! I'm here to help you with a wide range of topics.

## How I Can Assist You

I can help with various tasks including:

###  **Development & Coding**
- Web development (HTML, CSS, JavaScript, React)
- Backend development (Python, Node.js, APIs)
- Code debugging and optimization
- Architecture and design patterns

###  **Content Creation**
- Technical writing and documentation
- Creative writing and storytelling
- Business content and marketing copy
- Research and analysis

###  **Design & UI/UX**
- User interface design principles
- User experience optimization
- Design system creation
- Accessibility best practices

###  **Problem Solving**
- Complex analysis and reasoning
- Strategic planning and decision making
- Process optimization
- Educational explanations

Feel free to ask me anything specific, and I'll provide detailed, helpful responses tailored to your needs!`;
        }
        
        // Add message with Microsoft Copilot styling
        function addCopilotMessage(type, content) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            const timestamp = new Date().toLocaleTimeString('en-US', { 
                hour12: true, 
                hour: 'numeric', 
                minute: '2-digit' 
            });
            
            const messageActions = type === 'ai' ? `
                <div class="message-actions">
                    <button class="message-action" onclick="copyMessage(this)">
                        <i class="fas fa-copy"></i> Copy
                    </button>
                    <button class="message-action" onclick="regenerateMessage(this)">
                        <i class="fas fa-redo"></i> Regenerate
                    </button>
                    <button class="message-action" onclick="likeMessage(this)">
                        <i class="fas fa-thumbs-up"></i> Like
                    </button>
                    <button class="message-action" onclick="shareMessage(this)">
                        <i class="fas fa-share"></i> Share
                    </button>
                </div>
            ` : '';
            
            messageDiv.innerHTML = `
                <div class="message-avatar">
                    ${type === 'user' ? userAvatar.textContent : 'AJ'}
                </div>
                <div class="message-content">
                    <div class="message-bubble">
                        ${formatCopilotContent(content)}
                        ${messageActions}
                    </div>
                    <div class="message-timestamp">
                        <i class="fas fa-clock"></i>
                        ${timestamp}
                    </div>
                </div>
            `;
            
            chatContainer.appendChild(messageDiv);
            scrollToBottom();
            
            // Highlight code blocks
            messageDiv.querySelectorAll('pre code').forEach(block => {
                hljs.highlightElement(block);
            });
            
            state.chat.messages.push({ type, content, timestamp });
        }
        
        // Add message with realistic typing effect like Microsoft Copilot
        async function addCopilotMessageWithTypingEffect(type, content) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            const timestamp = new Date().toLocaleTimeString('en-US', { 
                hour12: true, 
                hour: 'numeric', 
                minute: '2-digit' 
            });
            
            messageDiv.innerHTML = `
                <div class="message-avatar">
                    ${type === 'user' ? userAvatar.textContent : 'AJ'}
                </div>
                <div class="message-content">
                    <div class="message-bubble">
                        <div class="copilot-response" id="typing-content"></div>
                        <div class="message-actions">
                            <button class="message-action" onclick="copyMessage(this)">
                                <i class="fas fa-copy"></i> Copy
                            </button>
                            <button class="message-action" onclick="regenerateMessage(this)">
                                <i class="fas fa-redo"></i> Regenerate
                            </button>
                            <button class="message-action" onclick="likeMessage(this)">
                                <i class="fas fa-thumbs-up"></i> Like
                            </button>
                            <button class="message-action" onclick="shareMessage(this)">
                                <i class="fas fa-share"></i> Share
                            </button>
                        </div>
                    </div>
                    <div class="message-timestamp">
                        <i class="fas fa-clock"></i>
                        ${timestamp}
                    </div>
                </div>
            `;
            
            chatContainer.appendChild(messageDiv);
            scrollToBottom();
            
            const contentDiv = messageDiv.querySelector('#typing-content');
            const formattedContent = formatCopilotContent(content);
            
            // Create a temporary div to parse the HTML
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = formattedContent;
            
            // Type out content with realistic speed
            await typeContent(contentDiv, tempDiv.innerHTML);
            
            // Highlight code blocks after typing is complete
            messageDiv.querySelectorAll('pre code').forEach(block => {
                hljs.highlightElement(block);
            });
            
            state.chat.messages.push({ type, content, timestamp });
        }
        
        // Realistic typing effect function
        async function typeContent(element, htmlContent) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = htmlContent;
            
            // Extract text content while preserving structure
            const textNodes = [];
            const walker = document.createTreeWalker(
                tempDiv,
                NodeFilter.SHOW_TEXT,
                null,
                false
            );
            
            let node;
            while (node = walker.nextNode()) {
                if (node.textContent.trim()) {
                    textNodes.push({
                        text: node.textContent,
                        parent: node.parentNode.cloneNode(false)
                    });
                }
            }
            
            // Type content progressively
            element.innerHTML = '';
            let currentHTML = '';
            
            for (const textNode of textNodes) {
                const text = textNode.text;
                const words = text.split(' ');
                
                for (let i = 0; i < words.length; i++) {
                    const word = words[i] + (i < words.length - 1 ? ' ' : '');
                    
                    // Add word to current content
                    currentHTML += word;
                    
                    // Update element with current progress
                    const progressDiv = document.createElement('div');
                    progressDiv.innerHTML = htmlContent;
                    
                    // Replace content up to current position
                    element.innerHTML = formatPartialContent(htmlContent, currentHTML.length);
                    
                    // Scroll to bottom
                    scrollToBottom();
                    
                    // Variable delay for realistic typing
                    const delay = word.includes('\n') ? 100 : 
                                 word.length > 10 ? 150 : 
                                 Math.random() * 100 + 50;
                    
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
            
            // Ensure final content is complete
            element.innerHTML = htmlContent;
            scrollToBottom();
        }
        
        // Helper function to format partial content during typing
        function formatPartialContent(fullHTML, currentLength) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = fullHTML;
            
            let textLength = 0;
            const walker = document.createTreeWalker(
                tempDiv,
                NodeFilter.SHOW_TEXT,
                null,
                false
            );
            
            let node;
            while (node = walker.nextNode()) {
                const nodeText = node.textContent;
                if (textLength + nodeText.length <= currentLength) {
                    textLength += nodeText.length;
                } else {
                    const remainingLength = currentLength - textLength;
                    node.textContent = nodeText.substring(0, remainingLength) + '';
                    textLength = currentLength;
                    break;
                }
            }
            
            // Remove any remaining nodes
            while (node = walker.nextNode()) {
                node.remove();
            }
            
            return tempDiv.innerHTML;
        }
        
        // Show Microsoft Copilot style typing indicator
        function showCopilotTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'copilot-typing';
            typingDiv.id = 'copilot-typing-indicator';
            
            typingDiv.innerHTML = `
                <div class="message-avatar">AJ</div>
                <div class="copilot-typing-bubble">
                    <span class="copilot-typing-text">AJ STUDIOZ is thinking</span>
                    <div class="copilot-typing-dots">
                        <div class="copilot-typing-dot"></div>
                        <div class="copilot-typing-dot"></div>
                        <div class="copilot-typing-dot"></div>
                    </div>
                </div>
            `;
            
            chatContainer.appendChild(typingDiv);
            scrollToBottom();
        }
        
        function removeCopilotTypingIndicator() {
            const typingIndicator = document.getElementById('copilot-typing-indicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }
        
        // Enhanced content formatting for Microsoft Copilot style
        function formatCopilotContent(content) {
            const div = document.createElement('div');
            div.className = 'copilot-response';
            
            // Convert markdown-style content to HTML
            let formatted = content
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/`([^`]+)`/g, '<code>$1</code>');
            
            // Handle code blocks with enhanced styling
            formatted = formatted.replace(/```(\w+)?\n([\s\S]*?)```/g, (match, language, code) => {
                const lang = language || 'text';
                const codeId = 'code-' + Math.random().toString(36).substr(2, 9);
                
                return `
                    <div class="copilot-code-block">
                        <div class="copilot-code-header">
                            <div class="code-language-badge">
                                <i class="fas fa-code"></i>
                                ${lang}
                            </div>
                            <div class="copilot-code-actions">
                                <button class="copilot-code-btn" onclick="copyCodeFromBlock('${codeId}')">
                                    <i class="fas fa-copy"></i> Copy
                                </button>
                                <button class="copilot-code-btn" onclick="downloadCode('${codeId}', '${lang}')">
                                    <i class="fas fa-download"></i> Download
                                </button>
                            </div>
                        </div>
                        <div class="copilot-code-content">
                            <pre id="${codeId}"><code class="language-${lang}">${escapeHtml(code.trim())}</code></pre>
                        </div>
                    </div>
                `;
            });
            
            // Handle headers with enhanced styling
            formatted = formatted.replace(/^## (.*$)/gm, '<h2>$1</h2>');
            formatted = formatted.replace(/^### (.*$)/gm, '<h3>$1</h3>');
            formatted = formatted.replace(/^#### (.*$)/gm, '<h4>$1</h4>');
            
            // Handle lists
            formatted = formatted.replace(/^[\s]*- (.*$)/gm, '<li>$1</li>');
            formatted = formatted.replace(/(<li>.*<\/li>)/s, '<ul>$1</ul>');
            
            // Handle blockquotes
            formatted = formatted.replace(/^> (.*$)/gm, '<blockquote>$1</blockquote>');
            
            // Handle tables
            formatted = formatted.replace(/\|(.+)\|\n\|[-\|]+\|\n((\|.+\|\n)+)/g, (match, header, body) => {
                const headers = header.split('|').map(h => h.trim()).filter(h => h);
                const rows = body.trim().split('\n').map(row => 
                    row.split('|').map(cell => cell.trim()).filter(cell => cell)
                );
                
                let tableHTML = '<div class="copilot-table-container"><table class="copilot-table"><thead><tr>';
                headers.forEach(header => {
                    tableHTML += `<th>${header}</th>`;
                });
                tableHTML += '</tr></thead><tbody>';
                
                rows.forEach(row => {
                    tableHTML += '<tr>';
                    row.forEach(cell => {
                        tableHTML += `<td>${cell}</td>`;
                    });
                    tableHTML += '</tr>';
                });
                
                tableHTML += '</tbody></table></div>';
                return tableHTML;
            });
            
            // Handle paragraphs
            const paragraphs = formatted.split('\n\n').filter(p => p.trim());
            formatted = paragraphs.map(p => {
                if (p.startsWith('<') || p.includes('<div') || p.includes('<ul') || p.includes('<h')) {
                    return p;
                }
                return `<p>${p.replace(/\n/g, '<br>')}</p>`;
            }).join('');
            
            div.innerHTML = formatted;
            return div.outerHTML;
        }
        
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }
        
        function scrollToBottom() {
            requestAnimationFrame(() => {
                chatContainer.scrollTop = chatContainer.scrollHeight;
            });
        }
        
        // Enhanced code block functions
        function copyCodeFromBlock(codeId) {
            const codeElement = document.getElementById(codeId);
            const code = codeElement.textContent;
            
            navigator.clipboard.writeText(code).then(() => {
                // Update button to show success
                const button = document.querySelector(`button[onclick="copyCodeFromBlock('${codeId}')"]`);
                const originalHTML = button.innerHTML;
                button.innerHTML = '<i class="fas fa-check"></i> Copied!';
                button.classList.add('success');
                
                setTimeout(() => {
                    button.innerHTML = originalHTML;
                    button.classList.remove('success');
                }, 2000);
                
                showToast('Code copied to clipboard!', 'success');
            }).catch(err => {
                showToast('Failed to copy code', 'error');
            });
        }
        
        function downloadCode(codeId, language) {
            const codeElement = document.getElementById(codeId);
            const code = codeElement.textContent;
            
            const extension = language === 'html' ? 'html' : 
                             language === 'css' ? 'css' : 
                             language === 'javascript' ? 'js' : 
                             language === 'python' ? 'py' : 'txt';
            
            const blob = new Blob([code], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `aj-studioz-code.${extension}`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('Code downloaded!', 'success');
        }
        
        function extractCodeFromResponse(response) {
            const codeBlockRegex = /```(\w+)?\n([\s\S]*?)```/g;
            let match;
            
            while ((match = codeBlockRegex.exec(response)) !== null) {
                const language = match[1] || 'text';
                const code = match[2];
                
                state.code.current = code;
                state.code.language = language;
                
                if (language === 'html') {
                    updatePreview(code);
                }
            }
        }
        
        function updatePreview(html) {
            if (previewFrame) {
                previewFrame.srcdoc = html;
                state.code.preview = html;
            }
        }
        
        function refreshPreview() {
            if (state.code.language === 'html' && state.code.current) {
                updatePreview(state.code.current);
                showToast('Preview refreshed!', 'success');
            } else {
                showToast('No HTML code to preview', 'error');
            }
        }
        
        function openInNewTab() {
            if (state.code.language === 'html' && state.code.current) {
                const newWindow = window.open();
                newWindow.document.write(state.code.current);
                newWindow.document.close();
            } else {
                showToast('No HTML code to preview', 'error');
            }
        }
        
        // Message action functions
        function copyMessage(button) {
            const messageBubble = button.closest('.message-bubble');
            const copilotResponse = messageBubble.querySelector('.copilot-response');
            const content = copilotResponse ? copilotResponse.textContent : messageBubble.textContent;
            
            navigator.clipboard.writeText(content.replace(/Copy|Regenerate|Like|Share/g, '').trim()).then(() => {
                showToast('Message copied to clipboard!', 'success');
            }).catch(err => {
                showToast('Failed to copy message', 'error');
            });
        }
        
        function regenerateMessage(button) {
            const messageDiv = button.closest('.message.ai');
            if (messageDiv && state.chat.messages.length > 0) {
                messageDiv.remove();
                const lastUserMessage = state.chat.messages.filter(msg => msg.type === 'user').pop();
                if (lastUserMessage) {
                    messageInput.value = lastUserMessage.content;
                    sendMessage();
                }
            }
        }
        
        function likeMessage(button) {
            button.classList.toggle('active');
            if (button.classList.contains('active')) {
                button.innerHTML = '<i class="fas fa-heart"></i> Liked';
                button.style.color = '#ef4444';
                showToast('Thanks for your feedback!', 'success');
            } else {
                button.innerHTML = '<i class="fas fa-thumbs-up"></i> Like';
                button.style.color = '';
            }
        }
        
        function shareMessage(button) {
            const messageBubble = button.closest('.message-bubble');
            const copilotResponse = messageBubble.querySelector('.copilot-response');
            const content = copilotResponse ? copilotResponse.textContent : messageBubble.textContent;
            
            if (navigator.share) {
                navigator.share({
                    title: 'AJ STUDIOZ AI Response',
                    text: content.replace(/Copy|Regenerate|Like|Share/g, '').trim()
                }).then(() => {
                    showToast('Message shared successfully!', 'success');
                }).catch(err => {
                    console.log('Error sharing:', err);
                });
            } else {
                // Fallback to clipboard
                copyMessage(button);
            }
        }
        
        function sendSuggestion(suggestion) {
            messageInput.value = suggestion;
            autoResize(messageInput);
            sendMessage();
        }
        
        function addToChatHistory(message) {
            const chatHistory = document.getElementById('chatHistory');
            const historyItem = document.createElement('div');
            historyItem.className = 'chat-history-item';
            historyItem.innerHTML = `
                <i class="fas fa-message"></i>
                <span>${message.length > 50 ? message.substring(0, 50) + '...' : message}</span>
            `;
            historyItem.onclick = () => {
                console.log('Load chat:', message);
            };
            
            chatHistory.insertBefore(historyItem, chatHistory.firstChild);
        }
        
        function startNewChat() {
            chatContainer.innerHTML = `
                <div class="empty-state" id="emptyState">
                    <div class="empty-state-icon">
                        <i class="fas fa-robot"></i>
                    </div>
                    <h2>Hello! I'm your AJ STUDIOZ AI Assistant</h2>
                    <p>I can help you with coding, creative writing, analysis, and answering questions. How can I assist you today?</p>
                    
                    <div class="suggestion-cards">
                        <div class="suggestion-card" onclick="sendSuggestion('Create a modern landing page with HTML, CSS, and JavaScript')">
                            <h3> Web Development</h3>
                            <p>Create a modern landing page with animations</p>
                        </div>
                        <div class="suggestion-card" onclick="sendSuggestion('Help me debug this Python code that is not working correctly')">
                            <h3> Code Debugging</h3>
                            <p>Debug and fix code issues</p>
                        </div>
                        <div class="suggestion-card" onclick="sendSuggestion('Write a creative story about AI and humans working together')">
                            <h3> Creative Writing</h3>
                            <p>Generate stories and creative content</p>
                        </div>
                        <div class="suggestion-card" onclick="sendSuggestion('Explain quantum computing in simple terms with examples')">
                            <h3> Explanations</h3>
                            <p>Explain complex topics simply</p>
                        </div>
                    </div>
                </div>
            `;
            state.chat.messages = [];
            state.chat.hasMessages = false;
            sidebarRight.classList.remove('active');
            messageInput.focus();
        }
        
        function clearChat() {
            if (confirm('Are you sure you want to clear this chat?')) {
                startNewChat();
                showToast('Chat cleared successfully!', 'success');
            }
        }
        
        function toggleSidebar() {
            sidebar.classList.toggle('open');
            state.ui.sidebarOpen = !state.ui.sidebarOpen;
        }
        
        function searchConversations(query) {
            const items = document.querySelectorAll('.chat-history-item');
            items.forEach(item => {
                const text = item.textContent.toLowerCase();
                if (text.includes(query.toLowerCase())) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }
        
        function createNewProject() {
            const projectName = prompt('Enter project name:');
            if (projectName) {
                const projectList = document.getElementById('projectList');
                const projectItem = document.createElement('div');
                projectItem.className = 'project-item';
                projectItem.innerHTML = `
                    <i class="fas fa-folder"></i>
                    <span>${projectName}</span>
                `;
                projectList.appendChild(projectItem);
                showToast('Project created successfully!', 'success');
            }
        }
        
        function loadChat(chatId) {
            console.log('Loading chat:', chatId);
        }
        
        function loadProject(projectId) {
            console.log('Loading project:', projectId);
        }
        
        function changeModel(model) {
            console.log('Model changed to:', model);
            showToast(`Model changed to ${model}`, 'success');
        }
        
        function changeTone(tone) {
            state.preferences.tone = tone;
            console.log('Tone changed to:', tone);
            showToast(`Tone changed to ${tone}`, 'success');
        }
        
        function changeDefaultTone(tone) {
            state.preferences.tone = tone;
            console.log('Default tone changed to:', tone);
            showToast(`Default tone changed to ${tone}`, 'success');
        }
        
        function toggleTheme() {
            const body = document.body;
            const themeToggle = document.getElementById('themeToggle');
            
            if (body.getAttribute('data-theme') === 'dark') {
                body.removeAttribute('data-theme');
                state.ui.theme = 'light';
                themeToggle.classList.remove('active');
            } else {
                body.setAttribute('data-theme', 'dark');
                state.ui.theme = 'dark';
                themeToggle.classList.add('active');
            }
            
            showToast(`Theme changed to ${state.ui.theme} mode`, 'success');
        }
        
        function toggleMemory() {
            const memoryToggle = document.getElementById('memoryToggle');
            state.preferences.memoryEnabled = !state.preferences.memoryEnabled;
            memoryToggle.classList.toggle('active');
            showToast(`Memory ${state.preferences.memoryEnabled ? 'enabled' : 'disabled'}`, 'success');
        }
        
        function toggleHistory() {
            const historyToggle = document.getElementById('historyToggle');
            state.preferences.historyEnabled = !state.preferences.historyEnabled;
            historyToggle.classList.toggle('active');
            showToast(`History ${state.preferences.historyEnabled ? 'enabled' : 'disabled'}`, 'success');
        }
        
        function toggleDataUsage() {
            const dataToggle = document.getElementById('dataToggle');
            state.preferences.dataUsageEnabled = !state.preferences.dataUsageEnabled;
            dataToggle.classList.toggle('active');
            showToast(`Data usage ${state.preferences.dataUsageEnabled ? 'enabled' : 'disabled'}`, 'success');
        }
        
        function toggleCodeSuggestions() {
            const codeToggle = document.getElementById('codeToggle');
            state.preferences.codeSuggestionsEnabled = !state.preferences.codeSuggestionsEnabled;
            codeToggle.classList.toggle('active');
            showToast(`Code suggestions ${state.preferences.codeSuggestionsEnabled ? 'enabled' : 'disabled'}`, 'success');
        }
        
        function updateQuotaBar() {
            const quotaBar = document.getElementById('quotaBar');
            const percentage = (state.quota.used / state.quota.total) * 100;
            quotaBar.style.width = `${percentage}%`;
            
            if (percentage >= 90) {
                quotaBar.style.background = 'linear-gradient(90deg, #ef4444, #dc2626)';
            } else if (percentage >= 70) {
                quotaBar.style.background = 'linear-gradient(90deg, #f59e0b, #d97706)';
            }
        }
        
        function upgradePlan() {
            showToast('Opening upgrade page...', 'success');
            // In a real app, this would redirect to a payment page
            setTimeout(() => {
                alert('Upgrade functionality would be implemented here');
            }, 1000);
        }
        
        function openSettings() {
            settingsModal.classList.add('active');
            state.ui.modals.settings = true;
        }
        
        function closeSettings() {
            settingsModal.classList.remove('active');
            state.ui.modals.settings = false;
        }
        
        function attachFile() {
            const input = document.createElement('input');
            input.type = 'file';
            input.multiple = true;
            input.onchange = (e) => handleFiles(e.target.files);
            input.click();
        }
        
        function handleFiles(files) {
            Array.from(files).forEach(file => {
                showToast(`File "${file.name}" uploaded successfully!`, 'success');
            });
        }
        
        function startVoiceInput() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                const recognition = new SpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'en-US';
                
                recognition.onstart = () => {
                    showToast('Listening... Speak now', 'success');
                };
                
                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    messageInput.value = transcript;
                    autoResize(messageInput);
                    showToast('Voice input captured!', 'success');
                };
                
                recognition.onerror = (event) => {
                    showToast('Voice input error: ' + event.error, 'error');
                };
                
                recognition.start();
            } else {
                showToast('Voice input not supported in this browser', 'error');
            }
        }
        
        function showToast(message, type = 'success') {
            const toastMessage = document.getElementById('toastMessage');
            const toastIcon = toast.querySelector('i');
            
            toastMessage.textContent = message;
            
            if (type === 'success') {
                toastIcon.className = 'fas fa-check-circle';
            } else if (type === 'error') {
                toastIcon.className = 'fas fa-exclamation-circle';
            }
            
            toast.className = `toast ${type} show`;
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 4000);
        }
        
        // Initialize app when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // No auto-login - user must authenticate
        });
    </script>
</body>
</html>
